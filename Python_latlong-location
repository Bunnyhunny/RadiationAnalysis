Convert Lat/Long to geocoding

https://github.com/gboeing/2014-summer-travels/blob/master/reverse-geocode-latlong.ipynb

#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Sat Apr 20 17:23:56 2019

@author: Xuezhen Liang
"""


import pandas as pd, requests, logging, time

lfh = logging.FileHandler('reverse_geocoder.log', mode='w', encoding='utf-8')
lfh.setFormatter(logging.Formatter('%(levelname)s %(asctime)s %(message)s'))
log = logging.getLogger('reverse_geocoder')
log.setLevel(logging.INFO)
log.addHandler(lfh)
log.info('process started')

df = pd.read_csv('latlng_loc.csv', encoding='utf-8', names=["time", "lat", "long", "value"])
df['geocode_data'] = ''
df['city'] = ''
df['country'] = ''

df.head()


api_key = "xxxx"


def reverse_geocode(latlng):
    time.sleep(0.1)
    url = 'https://maps.googleapis.com/maps/api/geocode/json?latlng={}' + "&key={}".format(api_key)
    request = url.format(latlng)
    log.info(request)
    response = requests.get(request)
    data = response.json()
    if 'results' in data and len(data['results']) > 0:
        return data['results'][0]

df['latlng'] = df.apply(lambda row: '{},{}'.format(row['lat'], row['long']), axis=1)
df['geocode_data'] = df['latlng'].map(reverse_geocode)
df.head()

def parse_city(geocode_data):
    if (not geocode_data is None) and ('address_components' in geocode_data):
        for component in geocode_data['address_components']:
            if 'locality' in component['types']:
                return component['long_name']
            elif 'postal_town' in component['types']:
                return component['long_name']
            elif 'administrative_area_level_2' in component['types']:
                return component['long_name']
            elif 'administrative_area_level_1' in component['types']:
                return component['long_name']
    return None

def parse_country(geocode_data):
    if (not geocode_data is None) and ('address_components' in geocode_data):
        for component in geocode_data['address_components']:
            if 'country' in component['types']:
                return component['long_name']
    return None


df['city'] = df['geocode_data'].map(parse_city)
df['country'] = df['geocode_data'].map(parse_country)
print(len(df))
df.head()

df.to_csv('radiation_city_usa.csv', encoding='utf-8', index=False)

